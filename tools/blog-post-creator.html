<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post Creator - Digital Allies</title>
    <meta name="description" content="Create and manage blog posts for Digital Allies with markdown editor, live preview, and SEO optimization.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <link rel="stylesheet" href="../assets/global.css">
    <style>
        /* Minimal fallback styles (used only if Tailwind fails to load) */
        :root { --blue:#2563eb; --gray:#4b5563; --gray-light:#f9fafb; --radius:0.5rem; }
        * { box-sizing: border-box; }
        body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; line-height:1.6; color:#333; margin:0; background:var(--gray-light); }
        .max-w-7xl { max-width:80rem; }
        .mx-auto { margin-left:auto; margin-right:auto; }
        .p-6 { padding:1.5rem; }
        .bg-white { background:#fff; }
        .rounded-lg { border-radius:var(--radius); }
        .shadow-sm { box-shadow:0 1px 2px rgba(0,0,0,.05); }
        h1 { font-size:1.875rem; margin:0 0 .5rem; }
        h2 { font-size:1.25rem; margin:0 0 1rem; }
        .text-gray-600 { color:var(--gray); }
        button { background:var(--blue); color:#fff; border:none; border-radius:var(--radius); padding:.5rem 1rem; cursor:pointer; font-size:.875rem; }
        button:hover { filter:brightness(.9); }
        input,select,textarea { width:100%; padding:.5rem .75rem; border:1px solid #d1d5db; border-radius:.375rem; font-size:.875rem; }
        input:focus,select:focus,textarea:focus { outline:none; border-color:var(--blue); box-shadow:0 0 0 2px rgba(37,99,235,.3); }
        .editor-container { min-height:400px; }
        .preview-content h1 { font-size:2.25rem; font-weight:700; margin:1rem 0; }
        .preview-content h2 { font-size:1.75rem; font-weight:600; margin:1.5rem 0 .75rem; }
        .preview-content h3 { font-size:1.25rem; font-weight:600; margin:1rem 0 .5rem; }
        .preview-content p { margin:0 0 1rem; }
        .preview-content blockquote { border-left:4px solid var(--blue); padding-left:1rem; margin:1rem 0; font-style:italic; color:var(--gray); }
        .preview-content code { background:#f1f5f9; padding:2px 4px; border-radius:4px; font-family:monospace; }
        .preview-content pre { background:#1e293b; color:#e2e8f0; padding:1rem; border-radius:8px; overflow:auto; }
        .draft-item { transition:box-shadow .2s, transform .2s; }
        .draft-item:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.1); }
        .hidden { display:none; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Blog Post Creator</h1>
                    <p class="text-gray-600">Create SEO-optimized blog posts with live preview and draft management</p>
                </div>
                <div class="flex space-x-3">
                    <button id="saveDraftBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Save Draft
                    </button>
                    <button id="showDraftsBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        Manage Drafts
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-2 gap-6">
            <!-- Left Panel: Form & Editor -->
            <div class="space-y-6">
                <!-- Metadata Form -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold mb-4">Post Metadata</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                            <input type="text" id="postTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter post title">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Slug</label>
                            <input type="text" id="postSlug" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="auto-generated">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="postCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select category</option>
                                <option value="Web Development">Web Development</option>
                                <option value="SEO">SEO</option>
                                <option value="Design">Design</option>
                                <option value="Business">Business</option>
                                <option value="Accessibility">Accessibility</option>
                                <option value="Technology">Technology</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Author</label>
                            <input type="text" id="postAuthor" value="Digital Allies" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Featured Image URL</label>
                            <input type="text" id="postImage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/assets/cover.jpg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Image Alt Text</label>
                            <input type="text" id="postImageAlt" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="A descriptive alt text for the featured image">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="postDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Brief description for SEO and preview"></textarea>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tags (comma-separated)</label>
                        <input type="text" id="postTags" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="web-development, seo, design">
                    </div>
                </div>

                <!-- Markdown Editor -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold mb-4">Content Editor</h2>
                    <textarea id="markdownEditor" class="w-full editor-container px-4 py-3 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Write your blog post in Markdown...

# Example Heading
This is a paragraph with **bold** and *italic* text.

## Subheading
- List item 1
- List item 2

```javascript
console.log('Code example');
```

> This is a blockquote"></textarea>
                    
                    <!-- Statistics -->
                    <div class="mt-4 flex flex-wrap gap-4 text-sm text-gray-600">
                        <span>Words: <span id="wordCount" class="font-semibold">0</span></span>
                        <span>Characters: <span id="charCount" class="font-semibold">0</span></span>
                        <span>Reading time: <span id="readingTime" class="font-semibold">0 min</span></span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Preview -->
            <div class="space-y-6">
                <!-- Live Preview -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold mb-4">Live Preview</h2>
                    <div id="previewContent" class="preview-content prose max-w-none">
                        <p class="text-gray-500 italic">Start typing to see your content preview...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="mt-6 bg-white rounded-lg shadow-sm p-6">
            <div class="flex flex-wrap gap-3">
                <button id="generateHtmlBtn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    Generate HTML
                </button>
                <button id="copyHtmlBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors" disabled>
                    Copy HTML
                </button>
                <button id="downloadHtmlBtn" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors" disabled>
                    Download HTML
                </button>
                <button id="previewSeoBtn" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                    Preview SEO
                </button>
            </div>
        </div>

        <!-- Generated HTML Output -->
        <div id="htmlOutput" class="mt-6 bg-white rounded-lg shadow-sm p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Generated HTML</h2>
            <pre id="htmlCode" class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code></code></pre>
        </div>

        <!-- SEO Preview -->
        <div id="seoPreview" class="mt-6 bg-white rounded-lg shadow-sm p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">SEO Preview</h2>
            <div class="space-y-4">
                <div class="border rounded-lg p-4 bg-blue-50">
                    <h3 class="font-semibold text-blue-900 mb-2">Google Search Result Preview</h3>
                    <div class="space-y-1">
                        <div id="seoTitle" class="text-blue-600 text-lg font-medium underline cursor-pointer"></div>
                        <div id="seoUrl" class="text-green-700 text-sm"></div>
                        <div id="seoDescription" class="text-gray-700 text-sm"></div>
                    </div>
                </div>
                <div class="border rounded-lg p-4 bg-gray-50">
                    <h3 class="font-semibold text-gray-900 mb-2">Social Media Preview</h3>
                    <div class="bg-white border rounded p-3">
                        <div id="socialTitle" class="font-semibold text-gray-900"></div>
                        <div id="socialDescription" class="text-gray-600 text-sm mt-1"></div>
                        <div id="socialUrl" class="text-gray-500 text-xs mt-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Drafts Modal -->
    <div id="draftsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-hidden">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-semibold">Draft Management</h2>
                        <button id="closeDraftsBtn" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6 max-h-[60vh] overflow-y-auto">
                    <div id="draftsList" class="space-y-4">
                        <!-- Drafts will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fallback markdown parser if CDN fails
        const fallbackMarkdownParser = {
            parse: (markdown) => {
                return markdown
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                    .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                    .replace(/^- (.*$)/gm, '<li>$1</li>')
                    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/^(?!<[h|u|b|l])(.+)$/gm, '<p>$1</p>')
                    .replace(/<p><\/p>/g, '');
            }
        };

        // Check if external libraries are available
        const hasMarked = typeof marked !== 'undefined';
        const hasDOMPurify = typeof DOMPurify !== 'undefined';

        // Initialize elements
        const titleInput = document.getElementById('postTitle');
        const slugInput = document.getElementById('postSlug');
        const categorySelect = document.getElementById('postCategory');
        const authorInput = document.getElementById('postAuthor');
        const descriptionInput = document.getElementById('postDescription');
        const tagsInput = document.getElementById('postTags');
        const markdownEditor = document.getElementById('markdownEditor');
        const previewContent = document.getElementById('previewContent');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const readingTime = document.getElementById('readingTime');

        let generatedHtml = '';
        let currentDraftId = null;

        // Auto-generate slug from title
        titleInput.addEventListener('input', () => {
            const slug = titleInput.value
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
            slugInput.value = slug;
            updatePreview();
            updateStats();
        });

        // Update preview on content change
        [descriptionInput, categorySelect, authorInput, tagsInput, markdownEditor].forEach(element => {
            element.addEventListener('input', () => {
                updatePreview();
                updateStats();
            });
        });

        function updatePreview() {
            const markdown = markdownEditor.value;
            if (markdown.trim() === '') {
                previewContent.innerHTML = '<p class="text-gray-500 italic">Start typing to see your content preview...</p>';
                return;
            }

            let html;
            if (hasMarked) {
                html = marked.parse(markdown);
                if (hasDOMPurify) {
                    html = DOMPurify.sanitize(html);
                }
            } else {
                html = fallbackMarkdownParser.parse(markdown);
            }
            
            previewContent.innerHTML = html;
        }

        function updateStats() {
            const text = markdownEditor.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const chars = text.length;
            const readingTimeMin = Math.ceil(words / 200); // Average reading speed

            wordCount.textContent = words;
            charCount.textContent = chars;
            readingTime.textContent = readingTimeMin + ' min';
        }

        // Generate SEO-optimized HTML
        function generateCompleteHtml() {
            const title = titleInput.value || 'Untitled Post';
            const slug = slugInput.value || 'untitled-post';
            const description = descriptionInput.value || '';
            const category = categorySelect.value || '';
            const author = authorInput.value || 'Digital Allies';
        const featuredImage = document.getElementById('postImage') ? document.getElementById('postImage').value.trim() : '';
        const featuredImageAlt = document.getElementById('postImageAlt') ? document.getElementById('postImageAlt').value.trim() : '';
            const tags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);
            const content = markdownEditor.value;
            
            let htmlContent;
            if (hasMarked) {
                htmlContent = marked.parse(content);
                if (hasDOMPurify) {
                    htmlContent = DOMPurify.sanitize(htmlContent);
                }
            } else {
                htmlContent = fallbackMarkdownParser.parse(content);
            }

            const currentDate = new Date().toISOString();
            const readingTimeMin = Math.ceil((content.trim() ? content.trim().split(/\s+/).length : 0) / 200);

            // Build HTML using string concatenation for better compatibility
            let html = '<!DOCTYPE html>';
            html += '<html lang="en">';
            html += '<head>';
            html += '<meta charset="UTF-8">';
            html += '<meta name="viewport" content="width=device-width, initial-scale=1.0">';
            html += '<title>' + title + ' - Digital Allies</title>';
            html += '<meta name="description" content="' + description + '">';
            html += '<meta name="keywords" content="' + tags.join(', ') + '">';
            html += '<meta name="author" content="' + author + '">';
            html += '<meta name="robots" content="index, follow">';
            html += '<link rel="canonical" href="https://digitalallies.net/blog/' + slug + '.html">';
            html += '<style>';
            html += 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #333; margin: 0; }';
            html += '.container { max-width: 1200px; margin: 0 auto; padding: 2rem; }';
            html += 'h1, h2, h3, h4, h5, h6 { color: #1f2937; margin-top: 1.5em; margin-bottom: 0.5em; }';
            html += 'h1 { font-size: 2.25rem; }';
            html += 'p { margin-bottom: 1rem; }';
            html += 'ul, ol { margin-bottom: 1rem; padding-left: 1.5rem; }';
            html += 'li { margin-bottom: 0.25rem; }';
            html += 'code { background: #f1f5f9; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-family: monospace; }';
            html += 'pre { background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }';
            html += 'pre code { background: none; padding: 0; }';
            html += 'blockquote { border-left: 4px solid #3b82f6; padding-left: 1rem; margin: 1rem 0; font-style: italic; color: #4b5563; }';
            html += '.meta { color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem; }';
            html += '</style>';
            html += '</head>';
            html += '<body>';
            html += '<div class="container">';
            html += '<article>';
            html += '<header>';
            if (category) {
                html += '<div class="meta">' + category + '</div>';
            }
            html += '<h1>' + title + '</h1>';
            if (description) {
                html += '<p>' + description + '</p>';
            }
            html += '<div class="meta">By ' + author + ' | ' + new Date(currentDate).toLocaleDateString() + ' | ' + readingTimeMin + ' min read</div>';
            // Insert featured image if provided
            if (featuredImage) {
                html += '<div class="mt-6">';
                html += '<img src="' + featuredImage + '" alt="' + (featuredImageAlt || '') + '" style="max-width:100%;height:auto;border-radius:8px;">';
                if (featuredImageAlt) {
                    html += '<p class="text-sm text-gray-500 mt-2">' + featuredImageAlt + '</p>';
                }
                html += '</div>';
            }
            if (tags.length > 0) {
                html += '<div>Tags: ' + tags.map(tag => '#' + tag).join(', ') + '</div>';
            }
            html += '</header>';
            html += '<div class="content">' + htmlContent + '</div>';
            html += '</article>';
            html += '</div>';
            html += '</body>';
            html += '</html>';

            return html;
        }

        // Generate HTML button
        document.getElementById('generateHtmlBtn').addEventListener('click', () => {
            generatedHtml = generateCompleteHtml();
            document.getElementById('htmlCode').textContent = generatedHtml;
            document.getElementById('htmlOutput').classList.remove('hidden');
            document.getElementById('copyHtmlBtn').disabled = false;
            document.getElementById('downloadHtmlBtn').disabled = false;
        });

        // Copy HTML button
        document.getElementById('copyHtmlBtn').addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(generatedHtml);
                const btn = document.getElementById('copyHtmlBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                btn.classList.add('bg-green-600');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-green-600');
                    btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
                alert('Failed to copy HTML. Please select and copy manually.');
            }
        });

        // Download HTML button
        document.getElementById('downloadHtmlBtn').addEventListener('click', () => {
            const slug = slugInput.value || 'untitled-post';
            const blob = new Blob([generatedHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${slug}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // SEO Preview button
        document.getElementById('previewSeoBtn').addEventListener('click', () => {
            const title = titleInput.value || 'Untitled Post';
            const slug = slugInput.value || 'untitled-post';
            const description = descriptionInput.value || 'No description provided.';
            
            document.getElementById('seoTitle').textContent = `${title} - Digital Allies`;
            document.getElementById('seoUrl').textContent = `https://digitalallies.net/blog/${slug}.html`;
            document.getElementById('seoDescription').textContent = description;
            
            document.getElementById('socialTitle').textContent = title;
            document.getElementById('socialDescription').textContent = description;
            document.getElementById('socialUrl').textContent = 'digitalallies.net';
            
            document.getElementById('seoPreview').classList.remove('hidden');
        });

        // Draft management
        function saveDraft() {
            const draft = {
                id: currentDraftId || Date.now().toString(),
                title: titleInput.value || 'Untitled Draft',
                slug: slugInput.value,
                category: categorySelect.value,
                author: authorInput.value,
                description: descriptionInput.value,
                tags: tagsInput.value,
                content: markdownEditor.value,
                lastSaved: new Date().toISOString(),
                wordCount: markdownEditor.value.trim() ? markdownEditor.value.trim().split(/\s+/).length : 0
            };

            const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
            const existingIndex = drafts.findIndex(d => d.id === draft.id);
            
            if (existingIndex >= 0) {
                drafts[existingIndex] = draft;
            } else {
                drafts.unshift(draft);
            }

            // Keep only latest 20 drafts
            if (drafts.length > 20) {
                drafts.splice(20);
            }

            localStorage.setItem('blogDrafts', JSON.stringify(drafts));
            currentDraftId = draft.id;

            // Show success feedback
            const btn = document.getElementById('saveDraftBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Saved!';
            btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            btn.classList.add('bg-green-600');
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('bg-green-600');
                btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }, 2000);
        }

        function loadDraft(draftId) {
            const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
            const draft = drafts.find(d => d.id === draftId);
            
            if (draft) {
                titleInput.value = draft.title || '';
                slugInput.value = draft.slug || '';
                categorySelect.value = draft.category || '';
                authorInput.value = draft.author || '';
                descriptionInput.value = draft.description || '';
                tagsInput.value = draft.tags || '';
                markdownEditor.value = draft.content || '';
                currentDraftId = draft.id;
                
                updatePreview();
                updateStats();
                
                document.getElementById('draftsModal').classList.add('hidden');
            }
        }

        function deleteDraft(draftId) {
            if (confirm('Are you sure you want to delete this draft?')) {
                const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
                const filteredDrafts = drafts.filter(d => d.id !== draftId);
                localStorage.setItem('blogDrafts', JSON.stringify(filteredDrafts));
                
                if (currentDraftId === draftId) {
                    currentDraftId = null;
                }
                
                showDrafts();
            }
        }

        function showDrafts() {
            const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
            const draftsList = document.getElementById('draftsList');
            
            if (drafts.length === 0) {
                draftsList.innerHTML = '<p class="text-gray-500 text-center py-8">No drafts saved yet.</p>';
            } else {
                draftsList.innerHTML = drafts.map(draft => {
                    const isActive = draft.id === currentDraftId;
                    return `
                        <div class="draft-item border rounded-lg p-4 ${isActive ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900 mb-1">
                                        ${draft.title}
                                        ${isActive ? '<span class="text-blue-600 text-sm font-normal">(Current)</span>' : ''}
                                    </h3>
                                    <p class="text-gray-600 text-sm mb-2">${draft.description || 'No description'}</p>
                                    <div class="flex items-center space-x-4 text-xs text-gray-500">
                                        <span>${draft.wordCount} words</span>
                                        <span>${draft.category || 'No category'}</span>
                                        <span>Saved ${new Date(draft.lastSaved).toLocaleDateString()}</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2 ml-4">
                                    <button onclick="loadDraft('${draft.id}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                        Load
                                    </button>
                                    <button onclick="deleteDraft('${draft.id}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('draftsModal').classList.remove('hidden');
        }

        // Auto-save draft every 30 seconds
        setInterval(() => {
            if (titleInput.value.trim() || markdownEditor.value.trim()) {
                saveDraft();
            }
        }, 30000);

        // Event listeners
        document.getElementById('saveDraftBtn').addEventListener('click', saveDraft);
        document.getElementById('showDraftsBtn').addEventListener('click', showDrafts);
        document.getElementById('closeDraftsBtn').addEventListener('click', () => {
            document.getElementById('draftsModal').classList.add('hidden');
        });

        // Make functions global for onclick handlers
        window.loadDraft = loadDraft;
        window.deleteDraft = deleteDraft;

        // Close modal when clicking outside
        document.getElementById('draftsModal').addEventListener('click', (e) => {
            if (e.target.id === 'draftsModal') {
                document.getElementById('draftsModal').classList.add('hidden');
            }
        });

        // Initial load
        updatePreview();
        updateStats();

        // Show warning if external libraries failed to load
        if (!hasMarked || !hasDOMPurify) {
            console.warn('Some external libraries failed to load. Using fallback functionality.');
        }
    </script>
</body>
</html>