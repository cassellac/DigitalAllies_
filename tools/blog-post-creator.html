<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Blog Post Creator - Digital Allies</title>
  <meta name="description" content="Create and manage blog posts for Digital Allies with markdown editor, live preview, and SEO optimization.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
  <link rel="stylesheet" href="../assets/global.css">
  <script src="../assets/js/global.js"></script>
  <style>
    :root { --blue:#2563eb; --gray:#4b5563; --gray-light:#f9fafb; --radius:0.5rem; }
    * { box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; line-height:1.6; color:#333; margin:0; background:var(--gray-light); }
    .max-w-7xl { max-width:80rem; }
    .editor-container { min-height:400px; }
    .preview-content h1 { font-size:2.25rem; font-weight:700; margin:1rem 0; }
    .preview-content h2 { font-size:1.75rem; font-weight:600; margin:1.5rem 0 .75rem; }
    .preview-content h3 { font-size:1.25rem; font-weight:600; margin:1rem 0 .5rem; }
    .preview-content p { margin:0 0 1rem; }
    .preview-content blockquote { border-left:4px solid var(--blue); padding-left:1rem; margin:1rem 0; font-style:italic; color:var(--gray); }
    .preview-content code { background:#f1f5f9; padding:2px 4px; border-radius:4px; font-family:monospace; }
    .preview-content pre { background:#1e293b; color:#e2e8f0; padding:1rem; border-radius:8px; overflow:auto; }
    .draft-item { transition:box-shadow .2s, transform .2s; }
    .draft-item:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .hidden { display:none; }
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <div class="max-w-7xl mx-auto p-6">
    <!-- Header Bar -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">Blog Post Creator</h1>
          <p class="text-gray-600">Create SEOâ€‘optimized blog posts with live preview and draft management</p>
        </div>
        <div class="flex space-x-3">
          <button id="saveDraftBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Save Draft</button>
          <button id="showDraftsBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">Manage Drafts</button>
        </div>
      </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-6">
      <!-- Left: Form + Editor -->
      <div class="space-y-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-xl font-semibold mb-4">Post Metadata</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                <input id="postTitle" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter post title">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Slug</label>
                <input id="postSlug" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="auto-generated">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                <select id="postCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <option value="">Select category</option>
                  <option>Web Development</option>
                  <option>SEO</option>
                  <option>Design</option>
                  <option>Business</option>
                  <option>Accessibility</option>
                  <option>Technology</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Author</label>
                <input id="postAuthor" type="text" value="Digital Allies" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Featured Image URL</label>
                <input id="postImage" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/assets/cover.jpg">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Image Alt Text</label>
                <input id="postImageAlt" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Describe the featured image">
              </div>
            </div>
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea id="postDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Brief description for SEO and preview"></textarea>
            </div>
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Tags (comma-separated)</label>
              <input id="postTags" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="seo, small business, web design">
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-xl font-semibold mb-4">Content Editor</h2>
          <textarea id="markdownEditor" class="w-full editor-container px-4 py-3 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="# Heading
Intro paragraph with **bold** and *italic* text.

## Subheading
- Bullet item
- Another item

Link example: [Visit Site](https://example.com)

> Quote block

Code:
console.log('Example');
"></textarea>
          <div class="mt-4 flex flex-wrap gap-4 text-sm text-gray-600">
            <span>Words: <span id="wordCount" class="font-semibold">0</span></span>
            <span>Characters: <span id="charCount" class="font-semibold">0</span></span>
            <span>Reading time: <span id="readingTime" class="font-semibold">0 min</span></span>
          </div>
        </div>
      </div>

      <!-- Right: Preview -->
      <div class="space-y-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-xl font-semibold mb-4">Live Preview</h2>
          <div id="previewContent" class="preview-content prose max-w-none">
            <p class="text-gray-500 italic">Start typing to see your content preview...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="mt-6 bg-white rounded-lg shadow-sm p-6">
      <div class="flex flex-wrap gap-3">
        <button id="generateHtmlBtn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Generate HTML</button>
        <button id="copyHtmlBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors" disabled>Copy HTML</button>
        <button id="downloadHtmlBtn" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors" disabled>Download HTML</button>
        <button id="previewSeoBtn" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors">Preview SEO</button>
      </div>
    </div>

    <!-- Generated HTML -->
    <div id="htmlOutput" class="mt-6 bg-white rounded-lg shadow-sm p-6 hidden">
      <h2 class="text-xl font-semibold mb-4">Generated HTML</h2>
      <pre id="htmlCode" class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code></code></pre>
    </div>

    <!-- SEO Preview -->
    <div id="seoPreview" class="mt-6 bg-white rounded-lg shadow-sm p-6 hidden">
      <h2 class="text-xl font-semibold mb-4">SEO Preview</h2>
      <div class="space-y-4">
        <div class="border rounded-lg p-4 bg-blue-50">
          <h3 class="font-semibold text-blue-900 mb-2">Google Search Result Preview</h3>
          <div class="space-y-1">
            <div id="seoTitle" class="text-blue-600 text-lg font-medium underline cursor-pointer"></div>
            <div id="seoUrl" class="text-green-700 text-sm"></div>
            <div id="seoDescription" class="text-gray-700 text-sm"></div>
          </div>
        </div>
        <div class="border rounded-lg p-4 bg-gray-50">
          <h3 class="font-semibold text-gray-900 mb-2">Social Media Preview</h3>
          <div class="bg-white border rounded p-3">
            <div id="socialTitle" class="font-semibold text-gray-900"></div>
            <div id="socialDescription" class="text-gray-600 text-sm mt-1"></div>
            <div id="socialUrl" class="text-gray-500 text-xs mt-1"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Draft Modal -->
  <div id="draftsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-hidden">
        <div class="p-6 border-b flex items-center justify-between">
          <h2 class="text-2xl font-semibold">Draft Management</h2>
          <button id="closeDraftsBtn" class="text-gray-500 hover:text-gray-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div class="p-6 max-h-[60vh] overflow-y-auto">
          <div id="draftsList" class="space-y-4"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- Element Handles ---------- */
    const titleInput = document.getElementById('postTitle');
    const slugInput = document.getElementById('postSlug');
    const categorySelect = document.getElementById('postCategory');
    const authorInput = document.getElementById('postAuthor');
    const descriptionInput = document.getElementById('postDescription');
    const tagsInput = document.getElementById('postTags');
    const markdownEditor = document.getElementById('markdownEditor');
    const previewContent = document.getElementById('previewContent');
    const wordCountEl = document.getElementById('wordCount');
    const charCountEl = document.getElementById('charCount');
    const readingTimeEl = document.getElementById('readingTime');

    let generatedHtml = '';
    let currentDraftId = null;

    /* ---------- Slug Auto-generation ---------- */
    titleInput.addEventListener('input', () => {
      const slug = titleInput.value
        .toLowerCase()
        .replace(/[^\w\s-]/g,'')
        .trim()
        .replace(/\s+/g,'-')
        .replace(/--+/g,'-');
      slugInput.value = slug;
      updatePreview();
      updateStats();
    });

    /* ---------- Live Updates ---------- */
    [descriptionInput, categorySelect, authorInput, tagsInput, markdownEditor].forEach(el => {
      el.addEventListener('input', () => { updatePreview(); updateStats(); });
    });

    function updatePreview() {
      const md = markdownEditor.value.trim();
      if (!md) {
        previewContent.innerHTML = '<p class="text-gray-500 italic">Start typing to see your content preview...</p>';
        return;
      }
      let html = typeof marked !== 'undefined' ? marked.parse(md) : md;
      if (typeof DOMPurify !== 'undefined') html = DOMPurify.sanitize(html);
      previewContent.innerHTML = html;
    }

    function updateStats() {
      const text = markdownEditor.value;
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      const chars = text.length;
      const mins = Math.ceil(words / 200) || 0;
      wordCountEl.textContent = words;
      charCountEl.textContent = chars;
      readingTimeEl.textContent = mins + ' min';
    }

    /* ---------- Generator ---------- */
    function generateCompleteHtml() {
      const title = titleInput.value || 'Untitled Post';
      const slug = slugInput.value || 'untitled-post';
      const description = descriptionInput.value || '';
      const category = categorySelect.value || '';
      const author = authorInput.value || 'Digital Allies';
      const featuredImage = document.getElementById('postImage').value.trim();
      const featuredImageAlt = document.getElementById('postImageAlt').value.trim();
      const tags = tagsInput.value.split(',').map(t => t.trim()).filter(Boolean);
      const content = markdownEditor.value;
      const currentDate = new Date().toISOString();
      const readingTimeMin = Math.ceil((content.trim() ? content.trim().split(/\s+/).length : 0) / 200);

      let htmlContent = typeof marked !== 'undefined' ? marked.parse(content) : content;
      if (typeof DOMPurify !== 'undefined') htmlContent = DOMPurify.sanitize(htmlContent);

      return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title} - Digital Allies</title>
  <meta name="description" content="${description}">
  <meta name="keywords" content="${tags.join(', ')}">
  <meta name="author" content="${author}">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://digitalallies.net/blog/${slug}.html">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/global.css">
  <script src="/assets/js/global.js"></script>
  <link rel="icon" type="image/png" href="/assets/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
  <link rel="shortcut icon" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Digital Allies" />
  <link rel="manifest" href="/assets/site.webmanifest" />
</head>
<body class="font-primary bg-white text-gray-dark">
  <!-- Language Toggle Bar -->
  <div class="bg-pale-blue py-2">
    <div class="max-w-7xl mx-auto px-4 flex justify-end">
      <div class="flex items-center space-x-2">
        <button onclick="toggleLanguage('en')" id="lang-en" class="px-3 py-1 text-sm font-medium text-primary-blue bg-white rounded-full shadow-sm">EN</button>
        <button onclick="toggleLanguage('es')" id="lang-es" class="px-3 py-1 text-sm font-medium text-gray-medium hover:text-primary-blue transition-colors">ES</button>
      </div>
    </div>
  </div>
  <!-- Header -->
  <header class="bg-white/95 backdrop-blur-sm border-b border-pale-blue sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-1">
          <div class="relative w-4 h-4 flex items-center justify-center">
            <div class="w-2 h-2 bg-primary-blue rounded-full brand-pulse"></div>
          </div>
          <h1 class="text-xl font-bold text-gradient">Digital Allies</h1>
        </div>
        <div class="hidden md:flex items-center space-x-8">
          <a href="/" class="text-primary-blue font-medium">Home</a>
          <a href="/about" class="text-gray-dark hover:text-primary-blue transition-colors">About</a>
          <a href="/services" class="text-gray-dark hover:text-primary-blue transition-colors">Services</a>
          <a href="/blog" class="text-gray-dark hover:text-primary-blue transition-colors">Blog</a>
          <a href="/contact" class="text-gray-dark hover:text-primary-blue transition-colors">Contact</a>
          <button class="bg-primary-blue text-white px-6 py-2 rounded-full hover:bg-blue-700 transition-colors gradient-shadow">Book Now</button>
        </div>
        <button class="md:hidden p-2" onclick="toggleMobileMenu()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-pale-blue">
        <div class="flex flex-col space-y-4 pt-4">
          <a href="/" class="text-primary-blue font-medium">Home</a>
          <a href="/about" class="text-gray-dark hover:text-primary-blue">About</a>
          <a href="/services" class="text-gray-dark hover:text-primary-blue">Services</a>
          <a href="/blog" class="text-gray-dark hover:text-primary-blue">Blog</a>
          <a href="/contact" class="text-gray-dark hover:text-primary-blue">Contact</a>
          <button class="bg-primary-blue text-white px-6 py-2 rounded-full hover:bg-blue-700 transition-colors w-fit">Book Now</button>
        </div>
      </div>
    </nav>
  </header>
  <!-- Blog Post -->
  <main class="max-w-4xl mx-auto px-4 py-16">
    <article>
      <header>
        <div class="meta text-sm text-gray-500 mb-2">${category}</div>
        <h1 class="text-4xl font-bold mb-4">${title}</h1>
        ${description ? `<p class="text-lg text-gray-700 mb-4">${description}</p>` : ""}
        <div class="meta text-sm text-gray-500 mb-6">By ${author} | ${new Date(currentDate).toLocaleDateString()} | ${readingTimeMin} min read</div>
        ${featuredImage ? `
          <figure class="mb-8">
            <img src="${featuredImage}" alt="${featuredImageAlt}" class="w-full h-auto rounded-lg shadow-sm">
            ${featuredImageAlt ? `<figcaption class="text-sm text-gray-500 mt-2">${featuredImageAlt}</figcaption>` : ""}
          </figure>
        ` : ""}
        ${tags.length ? `<div class="mb-8 flex flex-wrap gap-2">
          ${tags.map(t => `<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">#${t}</span>`).join('')}
        </div>` : ""}
      </header>
      <div class="prose max-w-none">${htmlContent}</div>
    </article>
  </main>
  <!-- Footer -->
  <footer class="bg-gray-dark text-white py-16">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid md:grid-cols-4 gap-8 mb-12">
        <div class="md:col-span-2">
          <div class="flex items-center space-x-1 mb-4">
            <div class="relative w-4 h-4 flex items-center justify-center">
              <div class="w-2 h-2 bg-white rounded-full"></div>
            </div>
            <span class="text-xl font-bold text-white">Digital Allies</span>
          </div>
          <p class="text-gray-300 mb-6 max-w-md">Creating digital solutions for the real world. We help small businesses thrive with accessible, beautiful web solutions that connect with your community.</p>
          <div class="flex space-x-4">
            <a href="#" class="w-10 h-10 bg-primary-blue rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors"></a>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
          <ul class="space-y-2">
            <li><a href="/" class="text-gray-300 hover:text-white transition-colors">Home</a></li>
            <li><a href="/about" class="text-gray-300 hover:text-white transition-colors">About</a></li>
            <li><a href="/services" class="text-gray-300 hover:text-white transition-colors">Services</a></li>
            <li><a href="/blog" class="text-gray-300 hover:text-white transition-colors">Blog</a></li>
            <li><a href="/accessibility-guide" class="text-gray-300 hover:text-white transition-colors">Accessibility Guide</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Services</h3>
          <ul class="space-y-2">
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Web Development</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Design & Branding</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Tech Consulting</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors">SEO Optimization</a></li>
            <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Maintenance</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-600 pt-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <p class="text-gray-300 text-sm mb-4 md:mb-0">Â© 2025 Digital Allies. All rights reserved.</p>
          <div class="flex space-x-6">
            <a href="/privacy" class="text-white hover:text-gray-300 text-sm transition-colors">Privacy Policy</a>
            <a href="/terms" class="text-white hover:text-gray-300 text-sm transition-colors">Terms of Service</a>
            <a href="/cookies" class="text-white hover:text-gray-300 text-sm transition-colors">Cookie Policy</a>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="/assets/js/global.js"></script>
</body>
</html>`;
    }

    /* ---------- Buttons & Actions ---------- */
    document.getElementById('generateHtmlBtn').addEventListener('click', () => {
      generatedHtml = generateCompleteHtml();
      document.getElementById('htmlCode').textContent = generatedHtml;
      document.getElementById('htmlOutput').classList.remove('hidden');
      document.getElementById('copyHtmlBtn').disabled = false;
      document.getElementById('downloadHtmlBtn').disabled = false;
    });

    document.getElementById('copyHtmlBtn').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(generatedHtml);
        flashButton('copyHtmlBtn','Copied!');
      } catch {
        alert('Copy failed. Select and copy manually.');
      }
    });

    document.getElementById('downloadHtmlBtn').addEventListener('click', () => {
      const slug = slugInput.value || 'untitled-post';
      const blob = new Blob([generatedHtml], { type:'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = slug + '.html';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    document.getElementById('previewSeoBtn').addEventListener('click', () => {
      const title = titleInput.value || 'Untitled Post';
      const slug = slugInput.value || 'untitled-post';
      const description = descriptionInput.value || 'No description provided.';
      document.getElementById('seoTitle').textContent = title + ' - Digital Allies';
      document.getElementById('seoUrl').textContent = 'https://digitalallies.net/blog/' + slug + '.html';
      document.getElementById('seoDescription').textContent = description;
      document.getElementById('socialTitle').textContent = title;
      document.getElementById('socialDescription').textContent = description;
      document.getElementById('socialUrl').textContent = 'digitalallies.net';
      document.getElementById('seoPreview').classList.remove('hidden');
    });

    /* ---------- Draft Management ---------- */
    function saveDraft() {
      const draft = {
        id: currentDraftId || Date.now().toString(),
        title: titleInput.value || 'Untitled Draft',
        slug: slugInput.value,
        category: categorySelect.value,
        author: authorInput.value,
        description: descriptionInput.value,
        tags: tagsInput.value,
        content: markdownEditor.value,
        lastSaved: new Date().toISOString(),
        wordCount: markdownEditor.value.trim() ? markdownEditor.value.trim().split(/\s+/).length : 0
      };
      const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
      const idx = drafts.findIndex(d => d.id === draft.id);
      idx >= 0 ? drafts.splice(idx,1,draft) : drafts.unshift(draft);
      if (drafts.length > 30) drafts.length = 30;
      localStorage.setItem('blogDrafts', JSON.stringify(drafts));
      currentDraftId = draft.id;
      flashButton('saveDraftBtn','Saved!');
    }

    function flashButton(id, text) {
      const btn = document.getElementById(id);
      const original = btn.textContent;
      btn.textContent = text;
      const prevBg = btn.className;
      btn.classList.add('bg-green-600');
      setTimeout(() => {
        btn.textContent = original;
        btn.className = prevBg;
      }, 1600);
    }

    function showDrafts() {
      const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
      const list = document.getElementById('draftsList');
      if (!drafts.length) {
        list.innerHTML = '<p class="text-center text-gray-500 py-8">No drafts saved yet.</p>';
      } else {
        list.innerHTML = drafts.map(d => `
          <div class="draft-item border rounded-lg p-4 ${d.id===currentDraftId ? 'border-blue-500 bg-blue-50':''}">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h3 class="font-semibold text-gray-900 mb-1">${d.title} ${d.id===currentDraftId?'<span class="text-blue-600 text-sm font-normal">(Current)</span>':''}</h3>
                <p class="text-gray-600 text-sm mb-2">${d.description || 'No description'}</p>
                <div class="flex items-center space-x-4 text-xs text-gray-500">
                  <span>${d.wordCount} words</span>
                  <span>${d.category || 'No category'}</span>
                  <span>Saved ${new Date(d.lastSaved).toLocaleDateString()}</span>
                </div>
              </div>
              <div class="flex space-x-2 ml-4">
                <button class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700" onclick="loadDraft('${d.id}')">Load</button>
                <button class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700" onclick="deleteDraft('${d.id}')">Delete</button>
              </div>
            </div>
          </div>`).join('');
      }
      document.getElementById('draftsModal').classList.remove('hidden');
    }

    function loadDraft(id) {
      const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]');
      const d = drafts.find(dr => dr.id === id);
      if (!d) return;
      titleInput.value = d.title;
      slugInput.value = d.slug;
      categorySelect.value = d.category;
      authorInput.value = d.author;
      descriptionInput.value = d.description;
      tagsInput.value = d.tags;
      markdownEditor.value = d.content;
      currentDraftId = d.id;
      updatePreview();
      updateStats();
      document.getElementById('draftsModal').classList.add('hidden');
    }

    function deleteDraft(id) {
      if (!confirm('Delete this draft?')) return;
      const drafts = JSON.parse(localStorage.getItem('blogDrafts') || '[]').filter(d => d.id !== id);
      localStorage.setItem('blogDrafts', JSON.stringify(drafts));
      if (currentDraftId === id) currentDraftId = null;
      showDrafts();
    }

    document.getElementById('saveDraftBtn').addEventListener('click', saveDraft);
    document.getElementById('showDraftsBtn').addEventListener('click', showDrafts);
    document.getElementById('closeDraftsBtn').addEventListener('click', () => {
      document.getElementById('draftsModal').classList.add('hidden');
    });
    document.getElementById('draftsModal').addEventListener('click', e => {
      if (e.target.id === 'draftsModal') e.currentTarget.classList.add('hidden');
    });

    // Auto-save every 30s if there is content
    setInterval(() => {
      if (titleInput.value.trim() || markdownEditor.value.trim()) saveDraft();
    }, 30000);

    updatePreview();
    updateStats();

    // Expose needed functions globally
    window.loadDraft = loadDraft;
    window.deleteDraft = deleteDraft;
  </script>
</body>
</html>
