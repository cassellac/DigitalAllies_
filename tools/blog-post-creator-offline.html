<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Blog Post Creator - Digital Allies</title>
    <meta name="description" content="Create blog posts for Digital Allies offline with no external dependencies.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .header h1 { color: #2563eb; font-size: 2rem; margin-bottom: 8px; }
        .header p { color: #666; }
        
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        @media (max-width: 768px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        
        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .panel h2 { color: #1f2937; margin-bottom: 20px; font-size: 1.25rem; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group-full { grid-column: 1 / -1; }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        #markdownEditor {
            min-height: 400px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            resize: vertical;
        }
        
        .stats {
            margin-top: 10px;
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .stats span { font-weight: 500; }
        
        .preview-content {
            min-height: 400px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 20px;
            background: #fafafa;
        }
        
        .preview-content h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: #1f2937; }
        .preview-content h2 { font-size: 1.5rem; font-weight: bold; margin: 1.5rem 0 0.75rem 0; color: #1f2937; }
        .preview-content h3 { font-size: 1.25rem; font-weight: bold; margin: 1rem 0 0.5rem 0; color: #1f2937; }
        .preview-content p { margin-bottom: 1rem; }
        .preview-content ul, .preview-content ol { margin-bottom: 1rem; padding-left: 1.5rem; }
        .preview-content li { margin-bottom: 0.25rem; }
        .preview-content blockquote {
            border-left: 4px solid #2563eb;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: #4b5563;
        }
        .preview-content code {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .preview-content pre {
            background: #1f2937;
            color: #e5e7eb;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .preview-content pre code { background: none; padding: 0; }
        
        .actions {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        
        .btn-success { background: #059669; color: white; }
        .btn-success:hover { background: #047857; }
        
        .btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .output {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 25px;
            margin-top: 20px;
            display: none;
        }
        
        .code-output {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 500px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #059669;
            color: white;
            border-radius: 6px;
            transform: translateX(300px);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .notification.show { transform: translateX(0); }
        
        .placeholder-text { color: #9ca3af; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Offline Blog Post Creator</h1>
            <p>Create SEO-optimized blog posts without external dependencies. Works entirely offline.</p>
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Left Panel: Form & Editor -->
            <div>
                <!-- Metadata Form -->
                <div class="panel">
                    <h2>Post Metadata</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="postTitle">Title *</label>
                            <input type="text" id="postTitle" placeholder="Enter post title">
                        </div>
                        <div class="form-group">
                            <label for="postSlug">Slug</label>
                            <input type="text" id="postSlug" placeholder="auto-generated">
                        </div>
                        <div class="form-group">
                            <label for="postCategory">Category</label>
                            <select id="postCategory">
                                <option value="">Select category</option>
                                <option value="Web Development">Web Development</option>
                                <option value="SEO">SEO</option>
                                <option value="Design">Design</option>
                                <option value="Business">Business</option>
                                <option value="Accessibility">Accessibility</option>
                                <option value="Technology">Technology</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="postAuthor">Author</label>
                            <input type="text" id="postAuthor" value="Digital Allies">
                        </div>
                        <div class="form-group form-group-full">
                            <label for="postDescription">Description</label>
                            <textarea id="postDescription" rows="3" placeholder="Brief description for SEO and preview"></textarea>
                        </div>
                        <div class="form-group form-group-full">
                            <label for="postTags">Tags (comma-separated)</label>
                            <input type="text" id="postTags" placeholder="web-development, seo, design">
                        </div>
                    </div>
                </div>

                <!-- Markdown Editor -->
                <div class="panel">
                    <h2>Content Editor</h2>
                    <textarea id="markdownEditor" placeholder="Write your blog post in Markdown...

# Example Heading
This is a paragraph with **bold** and *italic* text.

## Subheading
- List item 1  
- List item 2

```javascript
console.log('Code example');
```

> This is a blockquote"></textarea>
                    
                    <div class="stats">
                        <div>Words: <span id="wordCount">0</span></div>
                        <div>Characters: <span id="charCount">0</span></div>
                        <div>Reading time: <span id="readingTime">0 min</span></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Preview -->
            <div>
                <div class="panel">
                    <h2>Live Preview</h2>
                    <div id="previewContent" class="preview-content">
                        <p class="placeholder-text">Start typing to see your content preview...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button id="generateHtmlBtn" class="btn btn-success">Generate HTML</button>
            <button id="copyHtmlBtn" class="btn btn-primary" disabled>Copy HTML</button>
            <button id="downloadHtmlBtn" class="btn btn-secondary" disabled>Download HTML</button>
        </div>

        <!-- Generated HTML Output -->
        <div id="htmlOutput" class="output">
            <h2>Generated HTML</h2>
            <div id="htmlCode" class="code-output"></div>
        </div>
    </div>

    <script>
        // Minimal markdown parser (no external dependencies)
        const markdownParser = {
            parse: function(markdown) {
                if (!markdown.trim()) return '';
                
                let html = markdown
                    // Headers
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    
                    // Bold and italic
                    .replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    
                    // Code blocks
                    .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    
                    // Links
                    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
                    
                    // Blockquotes
                    .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                    
                    // Lists
                    .replace(/^\* (.*$)/gm, '<li>$1</li>')
                    .replace(/^- (.*$)/gm, '<li>$1</li>')
                    .replace(/^\d+\. (.*$)/gm, '<li>$1</li>');
                
                // Wrap consecutive list items in ul/ol tags
                html = html.replace(/(<li>.*?<\/li>)(\n<li>.*?<\/li>)*/g, function(match) {
                    return '<ul>' + match.replace(/\n/g, '') + '</ul>';
                });
                
                // Convert line breaks to paragraphs
                const lines = html.split('\n');
                const processedLines = [];
                let currentParagraph = '';
                
                for (let line of lines) {
                    line = line.trim();
                    if (line === '') {
                        if (currentParagraph) {
                            processedLines.push('<p>' + currentParagraph + '</p>');
                            currentParagraph = '';
                        }
                    } else if (line.match(/^<(h[1-6]|ul|ol|li|blockquote|pre)/)) {
                        if (currentParagraph) {
                            processedLines.push('<p>' + currentParagraph + '</p>');
                            currentParagraph = '';
                        }
                        processedLines.push(line);
                    } else {
                        currentParagraph += (currentParagraph ? ' ' : '') + line;
                    }
                }
                
                if (currentParagraph) {
                    processedLines.push('<p>' + currentParagraph + '</p>');
                }
                
                return processedLines.join('\n');
            },
            
            // Basic sanitization
            sanitize: function(html) {
                const allowedTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'br', 'strong', 'em', 'b', 'i', 
                                   'ul', 'ol', 'li', 'a', 'code', 'pre', 'blockquote'];
                const allowedAttributes = { 'a': ['href', 'target', 'rel'] };
                
                return html.replace(/<\/?([a-zA-Z][a-zA-Z0-9]*)[^>]*>/g, function(match, tag) {
                    tag = tag.toLowerCase();
                    if (allowedTags.includes(tag)) {
                        return match;
                    }
                    return '';
                });
            }
        };

        // Initialize elements
        const titleInput = document.getElementById('postTitle');
        const slugInput = document.getElementById('postSlug');
        const categorySelect = document.getElementById('postCategory');
        const authorInput = document.getElementById('postAuthor');
        const descriptionInput = document.getElementById('postDescription');
        const tagsInput = document.getElementById('postTags');
        const markdownEditor = document.getElementById('markdownEditor');
        const previewContent = document.getElementById('previewContent');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const readingTime = document.getElementById('readingTime');

        let generatedHtml = '';

        // Auto-generate slug from title
        titleInput.addEventListener('input', function() {
            const slug = this.value
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
            slugInput.value = slug;
            updatePreview();
            updateStats();
        });

        // Update preview on content change
        [descriptionInput, categorySelect, authorInput, tagsInput, markdownEditor].forEach(function(element) {
            element.addEventListener('input', function() {
                updatePreview();
                updateStats();
            });
        });

        function updatePreview() {
            const markdown = markdownEditor.value;
            if (markdown.trim() === '') {
                previewContent.innerHTML = '<p class="placeholder-text">Start typing to see your content preview...</p>';
                return;
            }

            const html = markdownParser.sanitize(markdownParser.parse(markdown));
            previewContent.innerHTML = html;
        }

        function updateStats() {
            const text = markdownEditor.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const chars = text.length;
            const readingTimeMin = Math.ceil(words / 200); // Average reading speed

            wordCount.textContent = words;
            charCount.textContent = chars;
            readingTime.textContent = readingTimeMin + ' min';
        }

        // Generate SEO-optimized HTML
        function generateCompleteHtml() {
            const title = titleInput.value || 'Untitled Post';
            const slug = slugInput.value || 'untitled-post';
            const description = descriptionInput.value || '';
            const category = categorySelect.value || '';
            const author = authorInput.value || 'Digital Allies';
            const tags = tagsInput.value.split(',').map(function(t) { return t.trim(); }).filter(function(t) { return t; });
            const content = markdownEditor.value;
            
            const htmlContent = markdownParser.sanitize(markdownParser.parse(content));
            const currentDate = new Date().toISOString();
            const wordCountNum = content.trim() ? content.trim().split(/\s+/).length : 0;
            const readingTimeMin = Math.ceil(wordCountNum / 200);

            const html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${escapeHtml(title)} - Digital Allies</title>
    <meta name="description" content="${escapeHtml(description)}">
    <meta name="keywords" content="${escapeHtml(tags.join(', '))}">
    <meta name="author" content="${escapeHtml(author)}">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://digitalallies.net/blog/${escapeHtml(slug)}.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://digitalallies.net/blog/${escapeHtml(slug)}.html">
    <meta property="og:title" content="${escapeHtml(title)}">
    <meta property="og:description" content="${escapeHtml(description)}">
    <meta property="og:site_name" content="Digital Allies">
    <meta property="article:author" content="${escapeHtml(author)}">
    <meta property="article:published_time" content="${currentDate}">
    <meta property="article:section" content="${escapeHtml(category)}">
    ${tags.map(function(tag) { 
        return '<meta property="article:tag" content="' + escapeHtml(tag) + '">';
    }).join('\n    ')}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://digitalallies.net/blog/${escapeHtml(slug)}.html">
    <meta property="twitter:title" content="${escapeHtml(title)}">
    <meta property="twitter:description" content="${escapeHtml(description)}">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "${escapeHtml(title)}",
        "description": "${escapeHtml(description)}",
        "author": {
            "@type": "Organization",
            "name": "${escapeHtml(author)}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Digital Allies",
            "url": "https://digitalallies.net"
        },
        "datePublished": "${currentDate}",
        "dateModified": "${currentDate}",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://digitalallies.net/blog/${escapeHtml(slug)}.html"
        },
        "url": "https://digitalallies.net/blog/${escapeHtml(slug)}.html",
        "keywords": "${escapeHtml(tags.join(', '))}",
        "articleSection": "${escapeHtml(category)}",
        "wordCount": ${wordCountNum},
        "timeRequired": "PT${readingTimeMin}M"
    }
    </script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        h1, h2, h3, h4, h5, h6 { color: #1f2937; margin-top: 1.5em; margin-bottom: 0.5em; }
        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.875rem; }
        h3 { font-size: 1.5rem; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-bottom: 1rem; padding-left: 1.5rem; }
        li { margin-bottom: 0.25rem; }
        blockquote { border-left: 4px solid #2563eb; padding-left: 1rem; margin: 1rem 0; font-style: italic; color: #4b5563; }
        code { background: #f1f5f9; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-family: monospace; }
        pre { background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }
        pre code { background: none; padding: 0; }
        a { color: #2563eb; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .meta { color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem; }
        .meta span { margin-right: 1rem; }
        .tag { background: #f3f4f6; color: #374151; padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; margin-right: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <article>
            <header style="margin-bottom: 2rem;">
                ${category ? '<div class="meta"><span style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">' + escapeHtml(category) + '</span></div>' : ''}
                <h1>${escapeHtml(title)}</h1>
                ${description ? '<p style="font-size: 1.125rem; color: #6b7280; margin-bottom: 1rem;">' + escapeHtml(description) + '</p>' : ''}
                <div class="meta">
                    <span>By ${escapeHtml(author)}</span>
                    <span>${new Date(currentDate).toLocaleDateString()}</span>
                    <span>${readingTimeMin} min read</span>
                </div>
                ${tags.length > 0 ? '<div style="margin-top: 1rem;">' + tags.map(function(tag) { 
                    return '<span class="tag">#' + escapeHtml(tag) + '</span>';
                }).join('') + '</div>' : ''}
            </header>
            
            <div class="content">
                ${htmlContent}
            </div>
        </article>
    </div>
</body>
</html>`;

            return html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(function() {
                notification.classList.remove('show');
                setTimeout(function() {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // Generate HTML button
        document.getElementById('generateHtmlBtn').addEventListener('click', function() {
            generatedHtml = generateCompleteHtml();
            document.getElementById('htmlCode').textContent = generatedHtml;
            document.getElementById('htmlOutput').style.display = 'block';
            document.getElementById('copyHtmlBtn').disabled = false;
            document.getElementById('downloadHtmlBtn').disabled = false;
            showNotification('HTML generated successfully!');
        });

        // Copy HTML button
        document.getElementById('copyHtmlBtn').addEventListener('click', function() {
            const textArea = document.createElement('textarea');
            textArea.value = generatedHtml;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('HTML copied to clipboard!');
            } catch (err) {
                showNotification('Failed to copy. Please select and copy manually.');
            }
            document.body.removeChild(textArea);
        });

        // Download HTML button
        document.getElementById('downloadHtmlBtn').addEventListener('click', function() {
            const slug = slugInput.value || 'untitled-post';
            const blob = new Blob([generatedHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = slug + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('HTML file downloaded!');
        });

        // Initial load
        updatePreview();
        updateStats();
    </script>
</body>
</html>